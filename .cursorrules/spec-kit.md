# Spec Kit Workflow Conventions

## Branch Naming

### Pattern

**Pattern:** `{feature-number}-{feature-slug}`

- **Feature Number**: Auto-incremented 3-digit number (001, 002, 003, ...)
  - Scans `specs/` directory for highest existing number
  - Increments by 1 for new feature
  
- **Feature Slug**: 
  - Generated by Copilot from feature description
  - 2-4 meaningful words in kebab-case
  - Filters common stop words (a, the, to, for, of, etc.)
  - Total branch name limited to 244 bytes (GitHub limit)

### Examples

- `"Add user authentication system"` → `001-user-authentication`
- `"Implement OAuth2 API integration"` → `002-oauth2-api-integration`
- `"Fix payment processing bug"` → `003-payment-processing-bug`

## Feature Directory Structure

When a feature branch is created:

```
specs/{branch-name}/
├── spec.md                    # Main specification
├── plan.md                    # Technical plan
├── tasks.md                   # Task breakdown
├── quickstart.md              # Quick start guide
├── README.md                  # Feature overview
├── checklists/
│   └── requirements.md       # Requirements checklist
└── contracts/
    └── *.md                   # API contracts and data models
```

## Spec Kit Workflow

### Trigger

Workflow `spec-kit-specify.yml` is triggered via:
- Azure DevOps Service Hook → Azure Function → GitHub `workflow_dispatch`
- Manual workflow dispatch from GitHub Actions UI

### Workflow Steps

1. **Generate branch name** from feature description
2. **Create feature branch** and directory structure
3. **Copy spec template** to `specs/{branch-name}/spec.md`
4. **Generate full specification** using Spec Kit prompts
5. **Commit specification** to feature branch
6. **Sync to ADO** by updating Feature Description

## Spec Kit Prompts

Prompts are stored in `.github/prompts/`:

- `speckit.specify.prompt.md` - Specification generation
- `speckit.plan.prompt.md` - Technical plan generation
- `speckit.clarify.prompt.md` - Clarification question extraction
- `speckit.checklist.prompt.md` - Requirements checklist generation

### Custom Prompts

Custom LLM prompts are in `.github/prompts/custom/`:
- `detect-clarification-questions.system.md` / `.user.md`
- `extract-questions.system.md` / `.user.md`

**IMPORTANT**: Custom prompts are separate from Spec Kit prompts to avoid conflicts during Spec Kit updates.

## Clarification Questions

Clarification questions are extracted from spec markdown and:
- Detected using LLM (gpt-4o)
- Extracted into structured format
- Created as child Issues in GitHub
- Closing Issues drives spec completeness

## Branch Creation Script

The script `.specify/scripts/bash/create-new-feature.sh`:
- Scans `specs/` for highest feature number
- Increments to get next number
- Validates branch name length (≤244 bytes)
- Creates branch and directory structure
- Returns JSON with branch name, spec file path, and feature number

## Spec Template

Template located at `.specify/templates/spec-template.md`:
- Copied to `specs/{branch-name}/spec.md` on branch creation
- Provides structure for Spec Kit to fill in
- Includes sections for: Overview, Requirements, Architecture, etc.

## Related Rules

- See [github-actions.md](github-actions.md) for workflow standards
- See [shell.md](shell.md) for script conventions
- See [ado-integration.md](ado-integration.md) for ADO integration patterns

